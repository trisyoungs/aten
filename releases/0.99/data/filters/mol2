importmodel
	name "Tripos (Sybyl) Mol2"
	nickname mol2
	extension "mol,mol2"
	glob *.mol*

	# Variable declaration
	integer n,natoms,nbonds,id,ii,jj,spgrp,setting
	character tripos,keywd,e,bondtype
	double rx,ry,rz,ca,cb,cc,alpha,beta,gamma

	# Read in lines, looking for the sections we're interested in.
	# All sections begin with '%<TRIPOS>', e.g. '%<TRIPOS>MOLECULE'
	# Read a line and parse it into '%<TRIPOS>' and keyword parts
	for $n
		readline "$tripos%9 $keywd"
		if $keywd = MOLECULE
			# Molecule information
			readline "$title%100"
			newmodel $title
			readline "$natoms $nbonds"
			# Skip the next three lines, which are type of molecule, charges used XXX, and user comment
			skipline 4
		elseif $keywd = ATOM
			for $n,1,$natoms
				readline "$id $e $rx $ry $rz"
				newatom $e
				setcoords $rx $ry $rz
			end
		elseif $keywd = BOND
			for $n,1,$nbonds
				readline "* $ii $jj $bondtype"
				newbond $ii $jj $bondtype
			end
		elseif $keywd = CRYSIN
			# Crystal cell information
			# Single line, format is ' a b c alpha beta gamma spgrp spgrp_setting'
			readline "$ca $cb $cc $alpha $beta $gamma $spgrp $setting"
			cell $ca $cb $cc $alpha $beta $gamma
	print $spgrp
			spacegroup $spgrp
		end
	end
	# Perform post-load operations
	pack
	fold
	finalisemodel
end
