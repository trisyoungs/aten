#
# Cubic water box (245 molecules)
# Unformatted trajectory has 100 frames (saved every 0.05 ps)
#	1. Test energy calculation c.f. DL_POLY
#	2. Calculate RDF
#

# Load forcefield and set zmapping to use forcefield atom names
loadff dlpolytest/water245/water245.ff waterff

# Load model and associate forcefield
loadmodel dlpolytest/water245/water245.CONFIG water
ffmodel

# Set up energy expression
clearpatterns
addpattern 245 3 h2o
#createexpression
elec ewald 0.40480 9 9 9
vcut 9.0
ecut 9.0

# Open trajectory
#loadtrajectory dlpolytest/water245/water245.HISf
loadtrajectory dlpolytest/water245/water245.HISu

# Calculate model energy and print totals
chargeff
modelenergy
printenergy
printewald

# Define molecular sites - COG and oxygen atom of water molecule
addsite com h2o
setaxes "2" "1"
addsite oxy h2o 1
printsites

# Request analysis
#rdf "water-com" com com 0.0 0.1 200 "water-centres.rdf"
#rdf "water-o" oxy oxy 0.0 0.1 200 "water-oxygens.rdf"
pdens "water-water" com com 0.5 20 "water.pdens"
printjobs

# Read in 50 frames from the trajectory, calculate and print an energy summary for each
repeat $n 100
	chargefrommodel
	frameenergy
	frameanalyse
	printsummary
	nextframe
end

# Take averages of calculated quantities
finalise

# Save quantities
savequantities

quit
