# Simple script to calculate the dipole moment of the current model and add it as a vector glyph.
# This only works for neutral, non-periodic systems.

double dx,dy,dz,cogx,cogy,cogz,mag
atom i

# Check that we have enough atoms to do the calculation
if $natoms < 2
	print "Less than two atoms in the model - no dipole to calculate!
	quit
end

$dx = 0
$dy = 0
$dz = 0
$cogx = 0
$cogy = 0
$cogz = 0

# Perform a loop over all atoms in the model
for $i
	$dx = "$dx + $i.rx * $i.q"
	$dy = "$dy + $i.ry * $i.q"
	$dz = "$dz + $i.rz * $i.q"
	$cogx = "$cogx + $i.rx"
	$cogy = "$cogy + $i.ry"
	$cogz = "$cogz + $i.rz"
end

# Take averages and get dipole magnitude
$dx = "$dx / $natoms"
$dy = "$dy / $natoms"
$dz = "$dz / $natoms"
$cogx = "$cogx / $natoms"
$cogy = "$cogy / $natoms"
$cogz = "$cogz / $natoms"
$mag = "($dx*$dx + $dy*$dy + $dz*$dz)^0.5"

# Add glyph to model
newglyph vector
glyphdata 1 $cogx $cogy $cogz
glyphdata 2 $dx $dy $dz

# Print data
print "Centre-of-geometry is at x=$cogx, y=$cogy, z=$cogz"
print "Dipole moment is x=$dx, y=$dy, z=$dz, |d|=$mag"
